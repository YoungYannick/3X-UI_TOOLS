# 3X-UI 多功能脚本

这是一个 Tampermonkey 脚本，用于增强 3X-UI 面板的功能，提供一键生成节点、关闭订阅访问、添加出站规则、配置路由规则、批量删除入站节点以及节点链接展示等便捷操作
![main](/images/1.png)
[更多截图请点击这里](/images)

## 描述

该脚本为 3X-UI 面板添加了一个浮动按钮，点击后弹出界面，支持多种协议节点的快速创建（如 VLESS、VMESS 和 SS），并提供其他实用工具。脚本通过 API 与面板交互，实现自动化配置。当前版本：**1.6**

## 功能

- **一键生成节点**：支持以下协议的节点创建（VLESS/VMESS/SS）：
  - VLESS TCP REALITY VISION
  - VLESS XHTTP REALITY
  - VLESS XHTTP Encryption (Post-Quantum) (非 TLS)
  - VLESS XHTTP Encryption (Post-Quantum) (TLS)
  - VLESS WS (非 TLS)
  - VLESS WS (TLS)
  - VMESS WS (非 TLS)
  - VMESS WS (TLS)
  - SHADOWSOCKS TCP (2022-BLAKE3-CHACHA20-POLY1305)
  - SHADOWSOCKS TCP (2022-BLAKE3-AES-256-GCM)
  - SHADOWSOCKS TCP (2022-BLAKE3-AES-128-GCM)
- **一键关闭订阅访问**：快速设置 `subEnable: false` 并重启面板
- **一键添加出站规则**：添加 `UseIPv4v6` 和 `UseIPv6v4` 出站规则，支持 IPv4/IPv6 优先策略
- **一键配置路由规则**：绑定入站节点到 IPv4 或 IPv6 优先出站，并保存配置
- **一键批量删除节点**：快速选择并删除多个入站节点，并重启 Xray
- **节点链接展示**：自动生成并展示所有可用节点的分享链接，支持复制单个链接或全部链接
- **配置管理**：自定义起始端口、Reality 回落地址、伪装域名，以及随机端口模式。配置保存在浏览器本地存储
- **拖拽浮动按钮**：界面友好，支持拖动浮动按钮位置

## 安装

1. 安装 [Tampermonkey](https://www.tampermonkey.net/) 浏览器扩展（支持 Chrome、Firefox 等浏览器）
2. 创建新脚本，或直接导入本脚本代码（从 `3X-UI_TOOLS.js` 文件复制）
3. 脚本匹配规则：`*://*/*/panel/*`，适用于 3X-UI 面板页面
4. 保存后，访问 3X-UI 面板即可看到右上角的浮动按钮（闪电图标）

## 使用

1. **打开界面**：在 3X-UI 面板页面，点击右上角的浮动按钮（闪电图标），弹出主面板
2. **生成节点**：
   - 选择需要创建的协议（支持多选）
   - 点击“一键创建选中节点”按钮
   - 脚本会自动检测可用端口、生成 UUID 等，并通过 API 添加节点
3. **关闭订阅**：点击“关闭订阅”按钮，设置 `subEnable: false` 并重启面板
4. **添加出站规则**：点击“添加出站”按钮，添加缺失的 IPv4/IPv6 出站规则，并重启 Xray
5. **配置路由规则**：
   - 点击“路由规则”按钮，弹出子面板
   - 选择 IPv4 或 IPv6 优先
   - 勾选需要绑定的入站节点
   - 点击“应用并保存”，更新路由规则并重启 Xray
6. **批量删除节点**：
   - 点击“批量删除”按钮，弹出删除面板
   - 选择需要删除的入站节点
   - 点击“确认删除”，删除选中节点并重启 Xray
7. **节点链接展示**：
   - 点击“展示节点”按钮，弹出节点列表面板
   - 查看每个节点的协议、端口和分享链接
   - 支持复制单个链接或一键复制所有链接
8. **全局配置**：
   - 点击“配置”链接，进入配置视图。
   - 修改起始端口、Reality Target、SNI 等
   - 点击“保存配置”，设置会持久化到浏览器本地存储

**注意**：
- TLS 相关节点需面板启用 HTTPS，并配置证书
- 随机端口模式会在 10000-60000 范围内随机选择端口
- 操作失败时会弹出错误提示。
- 节点链接生成基于当前面板地址，支持过期节点过滤和多代理支持

## 配置选项

- **起始查找端口 (startPort)**：默认 30000，从此端口开始查找可用端口
- **Reality 回落地址 (Target)**：默认 `www.apple.com:443`
- **Reality 伪装域名 (ServerName / SNI)**：默认 `www.apple.com`
- **启用随机端口模式**：默认关闭，启用后端口随机在 10000-60000 间生成

## 依赖

- 浏览器支持 `crypto.getRandomValues()`（现代浏览器均支持）
- 3X-UI 面板的 API 接口（如 `/panel/api/inbounds/add`、` /panel/xray/update` 等）

## 注意事项

- 该脚本仅在匹配的面板页面生效
- 操作涉及面板重启，请确保权限充足
- 如果遇到问题，检查浏览器控制台日志
- 脚本不修改服务器文件，仅通过 API 操作
- 更新脚本时，请备份现有配置，以免丢失自定义设置
- 支持的协议基于 Xray 核心，确保 3X-UI 版本兼容

## 更新日志

### 1.6（当前版本）
- 添加节点链接展示功能，支持复制单个链接或全部链接
- 优化协议选择界面，提高用户交互体验
- 修复批量删除节点的拼写错误和潜在的API调用问题
- 改进链接生成逻辑，支持更多协议变体
- 增强稳定性，减少浏览器兼容性问题

### 1.5
- 引入节点链接展示面板，允许用户查看和复制所有入站节点的分享链接
- 优化Shadowsocks协议支持，包括2022-BLAKE3系列加密方法
- 改进UI响应式设计，支持移动端浏览器
- 修复随机端口模式下的端口冲突检测

### 1.4
- 扩展批量删除节点功能，支持多选和确认对话框
- 添加对Post-Quantum加密的VLESS XHTTP变体（TLS和非TLS）
- 优化API调用，减少重启Xray的延迟
- 修复配置保存时的本地存储错误

### 1.3
- 添加一键批量删除入站节点功能，支持选择多个节点并重启Xray
- 引入Shadowsocks协议支持，包括三种2022-BLAKE3加密变体
- 改进路由规则配置面板，添加IPv4/IPv6优先选择

### 1.2
- 扩展协议支持，新增Shadowsocks TCP协议（2022-BLAKE3系列）
- 优化路由规则绑定逻辑
- 添加错误处理机制，在API失败时显示详细提示
- 改进浮动按钮的拖拽平滑度

### 1.1
- 添加VMESS WS (TLS) 和 VLESS WS (TLS) 协议支持
- 优化出站规则添加逻辑，自动检测缺失规则
- 引入异步API调用，提高脚本响应速度
- 修复配置视图中的输入验证问题

### 1.0
- 首个稳定版本
- 整合一键生成节点（VLESS/VMESS）、关闭订阅、添加出站规则和配置路由规则
- 添加悬浮球操作支持
- 优化UI设计，使用SVG图标和动画效果
- 引入配置持久化，使用本地存储保存用户设置

### 0.9
- 添加一键配置路由规则功能，支持绑定入站到IPv4/IPv6优先出站
- 扩展协议支持，包括VLESS XHTTP REALITY
- 改进toast通知系统，支持成功/错误图标
- 修复面板重启后的状态更新问题

### 0.8
- 引入一键添加出站规则功能，支持UseIPv4v6和UseIPv6v4
- 优化关闭订阅访问逻辑，确保subEnable设置为false
- 添加多协议选择界面，支持批量创建
- 改进CSS样式，增强视觉反馈

### 0.7
- 添加一键关闭订阅访问功能
- 引入悬浮球（浮动按钮）操作，支持拖拽定位
- 扩展VLESS/VMESS WS协议支持（非TLS）
- 优化事件监听，减少MutationObserver的使用

### 0.6
- 添加随机端口模式配置选项
- 改进协议信息面板，显示更多细节如uTLS和Flow
- 修复配置加载时的默认值覆盖问题

### 0.5
- 引入全局配置管理，支持自定义起始端口、Reality Target和SNI
- 添加本地存储持久化配置
- 扩展协议支持，包括VLESS WS和VMESS WS
- 优化UUID生成，使用crypto API

### 0.4
- 改进UI设计，使用SVG图标和复选框支持多选协议
- 添加全选/取消全选功能
- 优化节点创建流程，支持异步端口检测
- 修复面板宽度和溢出问题

### 0.3
- 添加VLESS WS (非TLS) 和 VMESS WS (非TLS) 协议支持
- 扩展面板宽度，支持更多协议显示
- 引入随机Path生成
- 优化样式动画，使用cubic-bezier曲线

### 0.2
- 添加VLESS XHTTP REALITY协议支持
- 引入协议折叠面板，显示详细配置信息
- 优化按钮样式和交互反馈
- 修复初始端口设置问题

### 0.1（初始版本）
- 基本功能实现，支持VLESS TCP REALITY VISION协议的一键生成
- 添加浮动按钮和弹出面板UI
- 集成API调用添加节点和重启Xray
- 默认配置包括起始端口、Target和SNI

## 贡献

欢迎提交 Issue 或 Pull Request 以改进脚本。作者：Yannick Young。